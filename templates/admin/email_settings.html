{% extends "admin/base.html" %}

{% block title %}Email Settings - Admin{% endblock %}
{% block page_title %}✉️ Email Settings{% endblock %}

{% block content %}
<div class="admin-container">
    <h1>Email Configuration</h1>
    
    {% if success %}
    <div class="alert alert-success" style="padding: 1rem; background: #d1fae5; border: 1px solid #6ee7b7; border-radius: 4px; margin-bottom: 1rem; color: #065f46;">
        ✓ {{ success }}
    </div>
    {% endif %}
    
    {% if error %}
    <div class="alert alert-error" style="padding: 1rem; background: #fee2e2; border: 1px solid #fca5a5; border-radius: 4px; margin-bottom: 1rem; color: #991b1b;">
        ✗ {{ error }}
    </div>
    {% endif %}
    
    <div class="card" style="padding: 2rem; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="margin-bottom: 1rem;">Current Configuration</h2>
        
        <div style="background: #f9fafb; padding: 1.5rem; border-radius: 4px; margin-bottom: 2rem;">
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 1rem; margin-bottom: 0.5rem;">
                <strong>SMTP Server:</strong>
                <code>{{ config.smtp_server }}</code>
            </div>
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 1rem; margin-bottom: 0.5rem;">
                <strong>SMTP Port:</strong>
                <code>{{ config.smtp_port }}</code>
            </div>
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 1rem; margin-bottom: 0.5rem;">
                <strong>Username:</strong>
                <code>{{ config.smtp_username if config.smtp_username else "Not configured" }}</code>
            </div>
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 1rem; margin-bottom: 0.5rem;">
                <strong>Password:</strong>
                <code>{{ "●●●●●●●●" if config.smtp_password else "Not configured" }}</code>
            </div>
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 1rem; margin-bottom: 0.5rem;">
                <strong>Sender Email:</strong>
                <code>{{ config.sender_email if config.sender_email else "Not configured" }}</code>
            </div>
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 1rem;">
                <strong>Sender Name:</strong>
                <code>{{ config.sender_name }}</code>
            </div>
        </div>
        
        <form method="POST" action="/admin/settings/email/test" style="margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1rem;">Test Email Configuration</h3>
            <div class="form-group">
                <label for="test_email">Send test email to:</label>
                <input type="email" id="test_email" name="test_email" value="{{ admin.email }}" required>
            </div>
            <button type="submit" class="btn btn-primary">Send Test Email</button>
        </form>
        
        <div style="background: #eff6ff; padding: 1.5rem; border-radius: 4px; border-left: 4px solid #3b82f6;">
            <h3 style="margin-top: 0; color: #1e40af;">How to Configure Email</h3>
            <p>Email settings are configured using environment variables. Set these before starting the server:</p>
            
            <h4 style="margin-top: 1rem;">For Gmail:</h4>
            <pre style="background: white; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.875rem;">export SMTP_SERVER="smtp.gmail.com"
export SMTP_PORT="587"
export SMTP_USERNAME="your-email@gmail.com"
export SMTP_PASSWORD="your-app-password"
export SENDER_EMAIL="your-email@gmail.com"
export SENDER_NAME="Your Name"</pre>
            
            <p style="margin-top: 1rem;"><strong>Note:</strong> For Gmail, you need to use an <a href="https://support.google.com/accounts/answer/185833" target="_blank" style="color: #2563eb;">App Password</a>, not your regular password.</p>
            
            <h4 style="margin-top: 1.5rem;">For other providers:</h4>
            <p>Update SMTP_SERVER and SMTP_PORT according to your email provider:</p>
            <ul style="margin-left: 1.5rem;">
                <li><strong>Outlook:</strong> smtp.office365.com:587</li>
                <li><strong>Yahoo:</strong> smtp.mail.yahoo.com:587</li>
                <li><strong>Custom:</strong> Check your provider's SMTP settings</li>
            </ul>
            
            <h4 style="margin-top: 1.5rem;">Using .env file:</h4>
            <p>Create a <code>.env</code> file in your project root:</p>
            <pre style="background: white; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.875rem;">SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SENDER_EMAIL=your-email@gmail.com
SENDER_NAME=Your Name</pre>
            
            <p style="margin-top: 1rem;">Then install and use <code>python-dotenv</code> to load these variables.</p>
        </div>
    </div>
</div>
{% endblock %}
