{% extends "admin/base.html" %}

{% block title %}Skills - Admin{% endblock %}
{% block page_title %}ðŸ’¡ Skills{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Skills</h1>
        <button onclick="toggleAddForm()" class="btn btn-primary" id="add-skill-btn">+ Add Skill</button>
    </div>
    
    <div id="add-skill" class="admin-form" style="display: none; margin-bottom: 2rem; background: white; padding: 2rem; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Add New Skill</h3>
        <form method="post" action="/admin/skills/new">
            <div class="form-row">
                <div class="form-group">
                    <label for="new_category">Category *</label>
                    <input type="text" id="new_category" name="category" required list="categories">
                    <datalist id="categories">
                        {% for category in skills.keys() %}
                        <option value="{{ category }}">
                        {% endfor %}
                    </datalist>
                </div>
                
                <div class="form-group">
                    <label for="new_name">Skill Name *</label>
                    <input type="text" id="new_name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="new_level">Level (0-100) *</label>
                    <input type="number" id="new_level" name="level" min="0" max="100" value="50" required>
                </div>
                
                <div class="form-group">
                    <label for="new_order">Order</label>
                    <input type="number" id="new_order" name="order" value="0">
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Add Skill</button>
                <button type="button" onclick="toggleAddForm()" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
    
    {% for category, category_skills in skills.items() %}
    <div class="skills-category-section">
        <h2>{{ category }}</h2>
        <div class="admin-table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Skill</th>
                        <th>Level</th>
                        <th>Order</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for skill in category_skills %}
                    <tr id="skill-{{ skill.id }}">
                        <td>
                            <input type="text" value="{{ skill.name }}" id="name-{{ skill.id }}" class="inline-input">
                        </td>
                        <td>
                            <input type="number" value="{{ skill.level }}" id="level-{{ skill.id }}" min="0" max="100" class="inline-input" style="width: 80px;">
                        </td>
                        <td>
                            <input type="number" value="{{ skill.order }}" id="order-{{ skill.id }}" class="inline-input" style="width: 80px;">
                        </td>
                        <td class="table-actions">
                            <form method="post" action="/admin/skills/{{ skill.id }}/edit" style="display: inline;" onsubmit="return updateSkill(event, {{ skill.id }}, '{{ category }}');">
                                <button type="submit" class="btn btn-sm btn-primary">Save</button>
                            </form>
                            <form method="post" action="/admin/skills/{{ skill.id }}/delete" style="display: inline;" onsubmit="return confirm('Are you sure?');">
                                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}
</div>

<script>
function toggleAddForm() {
    const form = document.getElementById('add-skill');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
    if (form.style.display === 'block') {
        form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// Check if hash is present to auto-open form
if (window.location.hash === '#add-skill') {
    toggleAddForm();
}

function updateSkill(event, skillId, category) {
    const form = event.target;
    const name = document.getElementById(`name-${skillId}`).value;
    const level = document.getElementById(`level-${skillId}`).value;
    const order = document.getElementById(`order-${skillId}`).value;
    
    // Add hidden inputs to form
    const categoryInput = document.createElement('input');
    categoryInput.type = 'hidden';
    categoryInput.name = 'category';
    categoryInput.value = category;
    form.appendChild(categoryInput);
    
    const nameInput = document.createElement('input');
    nameInput.type = 'hidden';
    nameInput.name = 'name';
    nameInput.value = name;
    form.appendChild(nameInput);
    
    const levelInput = document.createElement('input');
    levelInput.type = 'hidden';
    levelInput.name = 'level';
    levelInput.value = level;
    form.appendChild(levelInput);
    
    const orderInput = document.createElement('input');
    orderInput.type = 'hidden';
    orderInput.name = 'order';
    orderInput.value = order;
    form.appendChild(orderInput);
    
    return true;
}
</script>
{% endblock %}
