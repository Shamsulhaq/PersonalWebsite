{% extends "base.html" %}

{% block title %}Blog - {{ profile.name }}{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Blog & Thoughts</h1>
        <p>Sharing ideas and experiences</p>
        
        <!-- Search Form -->
        <form method="get" action="/blog" style="margin-top: 2rem; max-width: 500px; margin-left: auto; margin-right: auto;">
            <div style="display: flex; gap: 0.5rem;">
                <input type="text" name="search" placeholder="Search posts..." value="{{ search if search else '' }}" 
                       style="flex: 1; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); font-size: 1rem;">
                <button type="submit" class="btn btn-primary">Search</button>
                {% if search %}
                <a href="/blog" class="btn btn-secondary">Clear</a>
                {% endif %}
            </div>
        </form>
    </div>
</section>

<section class="section">
    <div class="container">
        {% if search %}
        <p style="margin-bottom: 2rem; color: var(--text-secondary);">
            Showing results for "<strong>{{ search }}</strong>"
        </p>
        {% endif %}
        
        <div class="blog-grid">
            {% for post in posts %}
            <article class="blog-card">
                {% if post.cover_image %}
                <div class="blog-card-image">
                    <img src="{{ post.cover_image }}" alt="{{ post.title }}" loading="lazy">
                </div>
                {% endif %}
                <div class="blog-card-content">
                    <div class="blog-meta">
                        <span class="blog-date">{{ post.published_at.strftime('%B %d, %Y') }}</span>
                        <span class="blog-views">üëÅÔ∏è {{ post.view_count or 0 }} views</span>
                    </div>
                    <h2 class="blog-title">
                        <a href="/blog/{{ post.slug }}" hx-boost="true">{{ post.title }}</a>
                    </h2>
                    <p class="blog-excerpt">{{ post.excerpt }}</p>
                    
                    <div class="blog-tags">
                        {% for tag in post.tags.split(',') %}
                        <span class="tag">{{ tag }}</span>
                        {% endfor %}
                    </div>
                    
                    <a href="/blog/{{ post.slug }}" class="blog-read-more" hx-boost="true">
                        Read more ‚Üí
                    </a>
                </div>
            </article>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="pagination" style="margin-top: 3rem; display: flex; justify-content: center; gap: 0.5rem; flex-wrap: wrap;">
            {% if page > 1 %}
            <a href="/blog?page={{ page - 1 }}{% if search %}&search={{ search }}{% endif %}" class="btn btn-secondary">‚Üê Previous</a>
            {% endif %}
            
            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                <span class="btn btn-primary">{{ p }}</span>
                {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                <a href="/blog?page={{ p }}{% if search %}&search={{ search }}{% endif %}" class="btn btn-secondary">{{ p }}</a>
                {% elif p == page - 3 or p == page + 3 %}
                <span style="padding: 0.5rem;">...</span>
                {% endif %}
            {% endfor %}
            
            {% if page < total_pages %}
            <a href="/blog?page={{ page + 1 }}{% if search %}&search={{ search }}{% endif %}" class="btn btn-secondary">Next ‚Üí</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
